-------------------------
Ansible Training Program
-------------------------

-------------
Session 1:
-------------

Pre-Docker Era - How We Used to Run Applications:
-------------------------------------------------

Before containers existed, all applications were deployed on:
- Physical machines
- Virtual Machines (VMs)

Example:
You want to run a website that needs:
- 3 VMs (or 30, depending on scale)
- Nginx web server on all servers
- Nginx config files such as: /etc/nginx/conf.d/vhost.conf
- With Routing rules:
    - /api → Java service
    - /app → NodeJS service
- Java installed (specific version)
- OS-level configurations:
    - 5 user accounts (e.g., deploy)
    - /etc/fstab entries

This was all manual and followed no standard and it was difficult to setup everything in either 3 or 30 VMs with regular manual enhancements.

Then shell scripts were developed to deploy and updated these.


The Problem With Script-Based Automation:
-----------------------------------------

- Shell scripts are NOT idempotent
    - Idempotency = Running code multiple times should not break things.
    - In the first run it installs & configures everything
    - In the Second run -> usually fails or re-installs, overwrites configs, breaks system
- Scripts have no concept of desired state
- Scripts cannot detect drift or partial changes
- Scripts don't understand dependencies
- Scripts become large, fragile, and hard to maintain
- Simple automation ≠ reliable infrastructure.

The Rise of Configuration Management (CM) Tools:
------------------------------------------------

Tools like:
Puppet
Chef
Ansible

Introduced:
- Idempotency
- Standardization
- Configuration as Code
- Repeatability & version control

General Benefits:
- They solved OS-level automation: installing Nginx / Java / NodeJS / Apache / ElasticSearch
- managing config files
- creating users
- setting permissions
- ensuring services are running
- enforcing desired state continuously

Agent vs Agentless Configuration Management Tools:
---------------------------------------------------

Agent-based:
- A small software agent runs on every managed node
- Pulls configuration from a master
e.g.: Chef and Puppet

Agentless:
- Uses SSH on port 22 (Linux) & WinRM (Windows)
- Uses control node which has all the desired configuration code and connects to the target nodes and apply the changes.
- Extremely simple to start with

Using CM Tools With AWS (A combined use case of IAC and CM):
------------------------------------------------------------

- The requirement is to host a website in AWS:
    10 EC2 servers
    Load Balanced via ALB
    Nginx on each EC2
    Application runtimes (Java, NodeJS, etc.)

- The Infrastructure Step
    Use Terraform to provision:
        10 EC2 instances
        Load Balancer
        VPC, Subnets, Route Tables
        Security Groups

- The Configuration Step
Use Ansible to configure the EC2s:
    Install Nginx
    Install Java
    Deploy config files
    Set up services
    Apply OS hardening

This separation is important:
Terraform -> builds servers along with the complete environment including networks, load balancers, databases etc.
Ansible -> configures servers

Why Ansible Roles are Used:
---------------------------

Scenario:

- Team A requires following to be installed and configured on their 10 servers:
Java
Tomcat
NodeJS
Nginx
Elasticsearch

You write playbooks with tasks for each software.

- Team B requires following to be installed and configured on their 50 servers::
Java
Tomcat
Nginx

- Without roles:
You repeat tasks again
Copy-paste code
Redundancy grows
Maintenance becomes impossible
"Reinventing the wheel" every time

- Solution → Ansible Roles

Roles allow packaging reusable logic:
roles/
  java/
  tomcat/
  nginx/
  nodejs/
  elasticsearch/

Then:
Team A playbook calls:
roles:
  - java
  - tomcat
  - nodejs
  - nginx
  - elasticsearch

Team B playbook calls:
roles:
  - java
  - tomcat
  - nginx

Roles = modular, reusable, maintainable CM code
Similar to how Terraform uses modules

Useful Reference:
-----------------

Ansible Facts Gathering:
https://docs.ansible.com/ansible/latest/user_guide/playbooks_vars_facts.html